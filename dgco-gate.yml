server:
  port: 8060
logging:
  config: file:/opt/dgco/gate/config/logback-spring.xml
spring:
  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedHeaders: "*"
            allowedMethods: "*"
      discovery:
        locator:
          enabled: true
      routes:
      # OPERE
      - id: opere-service
        uri: http://localhost:8080
        predicates:
        #- Path=/opere/**
        #- Before=2023-04-27T12:16:00.000000000+02:00[Europe/Berlin]
        #- Header=X-Request-Id, 222
        - Method=GET,POST
        filters:
        #- RewritePath=/opere/(?<path>.*), /$\{path}
        #- AddRequestHeader=X-Request, ciao_opere_REQUEST
        #- AddResponseHeader=X-Response, ciao_opere_RESPONSE
        #- RedirectTo=303, https://uat.interop.pagopa.it/.well-known/jwks.json

      # DOMANDE
      - id: domande-service
        uri: http://localhost:8081
        predicates:
        #- Path=/domande/**
        #- After=2023-04-27T12:16:00.000000000+02:00[Europe/Berlin]
        #- Header=X-Request-Id, 111
        - Method=PUT
        filters:
        #- RewritePath=/domande/(?<path>.*), /$\{path}
        #- AddRequestHeader=X-Request, ciao_domande_REQUEST
        #- AddResponseHeader=X-Response, ciao_domande_RESPONSE
        #- RedirectTo=303, https://uat.interop.pagopa.it/.well-known/jwks.json
        - name: Retry
          args:
            retries: 3
            statuses: INTERNAL_SERVER_ERROR
            methods: PUT
            backoff:
              firstBackoff: 10ms
              maxBackoff: 50ms
              factor: 2
              basedOnPreviousValue: false
              
      - id: json-grpc
        uri: https://localhost:8082/testhello
        predicates:
        - Path=/json/**
        filters:
        - name: JsonToGrpc
          args:
            protoFile: file:proto/hello.proto
            service: com.example.grpcserver.hello.HelloService
            method: hello

      # Only 4 OAS3
      - id: openapi
        uri: http://localhost:8060
        predicates:
        - Path=/v3/api-docs/**
        filters:
        - RewritePath=/v3/api-docs/(?<path>.*), /$\{path}/v3/api-docs
        - OpenApiDocFilter
springdoc:
  swagger-ui:
    doc-expansion: none
    path: /swagger-ui.html
    display-request-duration: true
    
management:
  endpoint:
    restart:
      enabled: true
  endpoints:
    web:
      exposure:
        include: '*'

auth:
  api:
    enable: false
