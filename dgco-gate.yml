server:
  port: 8060
logging:
  config: file:/opt/dgco/gate/config/logback-spring.xml
spring:
  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedHeaders: "*"
            allowedMethods: "*"
      discovery:
        locator:
          enabled: true
      routes:
      # OPERE
      - id: opere-service
        uri: http://localhost:8080
        predicates:
        #- Path=/opere/**
        #- Before=2023-04-27T12:16:00.000000000+02:00[Europe/Berlin]
        #- Header=X-Request-Id, 222
        - Method=GET,POST
        filters:
        #- RewritePath=/opere/(?<path>.*), /$\{path}
        #- AddRequestHeader=X-Request, ciao_opere_REQUEST
        #- AddResponseHeader=X-Response, ciao_opere_RESPONSE
        #- RedirectTo=303, https://uat.interop.pagopa.it/.well-known/jwks.json

      # DOMANDE
      - id: domande-service
        uri: http://localhost:8081
        predicates:
        #- Path=/domande/**
        #- After=2023-04-27T12:16:00.000000000+02:00[Europe/Berlin]
        #- Header=X-Request-Id, 111
        - Method=PUT
        filters:
        - CircuitBreaker=resilienceCircuitBreaker
        #- RewritePath=/domande/(?<path>.*), /$\{path}
        #- AddRequestHeader=X-Request, ciao_domande_REQUEST
        #- AddResponseHeader=X-Response, ciao_domande_RESPONSE
        #- RedirectTo=303, https://uat.interop.pagopa.it/.well-known/jwks.json

      # Only 4 OAS3
      - id: openapi
        uri: http://localhost:8060
        predicates:
        - Path=/v3/api-docs/**
        filters:
        - RewritePath=/v3/api-docs/(?<path>.*), /$\{path}/v3/api-docs
        - OpenApiDocFilter
springdoc:
  swagger-ui:
    doc-expansion: none
    path: /swagger-ui.html
    display-request-duration: true
    
management:
  endpoint:
    restart:
      enabled: true
  endpoints:
    web:
      exposure:
        include: '*'

auth:
  api:
    enable: false
    
# --- RESILIENCE4J PROPERTIES --- #
      
# TIME LIMITER
resilience4j.timelimiter:
  configs:
    default:
      timeout-duration: 5s
  instances:
    resilienceCircuitBreaker:
      base-config: default

# RATE LIMITER
resilience4j.ratelimiter:
  configs:
    default:
      limitForPeriod: 2
      limitRefreshPeriod: 1s
      timeoutDuration: 1s
  instances:
    resilienceCircuitBreaker:
      base-config: default
      
# RETRY
resilience4j:
  retry:
    retry-aspect-order: 2
    instances:
      resilienceCircuitBreaker:
        max-attempts: 3
        wait-duration: 5s
        enable-exponential-backoff: true
        exponential-backoff-multiplier: 2
        retry-exceptions:
         - java.lang.Exception
         - java.net.ConnectException
